\section{代入原理}
	$a$と$b$を類とし，$\varphi$を$x$のみが自由に現れる式とするとき，
	\begin{align}
		a = b
	\end{align}
	ならば$a$と$b$をそれぞれ$\varphi$の自由な$x$に代入しても
	\begin{align}
		\varphi(a) \lrarrow \varphi(b)
	\end{align}
	が成立するというのは{\bf 代入原理}\index{だいにゅうげんり@代入原理}
	{\bf (the principle of substitution)}と呼ばれる．
	第\ref{sec:restriction_of_formulas}節で決めたことをここでも注意しておくと，
	{\bf 式に現れる$\varepsilon$項は全て主要$\varepsilon$項であり，
	式に現れる内包項は全て正則内包項であり，
	項や式の上に現れる$\forall x \psi,\exists x \psi$なる形の式は，
	$\psi$の中に$x$が自由に現れている．}
	
	\begin{screen}
		\begin{logicalthm}[含意の論理和への遺伝性2]
		\label{logicalthm:heredity_of_implication_to_disjunction_2}
			$A,B,C,D$を文とするとき
			\begin{align}
				A \rarrow C,\ B \rarrow D \vdash A \vee B \rarrow C \vee D.
			\end{align}
		\end{logicalthm}
	\end{screen}
	
	\begin{sketch}
		三段論法より
		\begin{align}
			A,\ A \rarrow C \vdash C
		\end{align}
		が成り立ち，論理和の導入より
		\begin{align}
			A,\ A \rarrow C \vdash C \vee D
		\end{align}
		が成り立つので，
		\begin{align}
			A \rarrow C \vdash A \rarrow C \vee D
		\end{align}
		が従う．同様に
		\begin{align}
			B \rarrow D \vdash B \rarrow C \vee D
		\end{align}
		も成り立ち，論理和の除去より
		\begin{align}
			A \rarrow C,\ B \rarrow D \vdash A \vee B \rarrow C \vee D
		\end{align}
		が得られる．
		\QED
	\end{sketch}
	
	\begin{screen}
		\begin{logicalthm}[含意の論理積への遺伝性2]
		\label{logicalthm:heredity_of_implication_to_conjunction_2}
			$A,B,C,D$を文とするとき，
			\begin{align}
				A \rarrow C,\ B \rarrow D \vdash A \wedge B \rarrow C \wedge D.
			\end{align}
		\end{logicalthm}
	\end{screen}
	
	\begin{sketch}
		論理積の除去より
		\begin{align}
			A \wedge B \vdash A
		\end{align}
		が成り立つので，三段論法より
		\begin{align}
			A \wedge B,\ A \rarrow C \vdash C
		\end{align}
		が従う．同様に
		\begin{align}
			A \wedge B,\ B \rarrow D \vdash D
		\end{align}
		も成り立ち，論理積の導入より
		\begin{align}
			A \wedge B,\ A \rarrow C,\ B \rarrow D \vdash C \wedge D
		\end{align}
		が従う．
		\QED
	\end{sketch}
	
	\begin{screen}
		\begin{logicalthm}[含意の含意への遺伝性2]
		\label{logicalthm:heredity_of_implication_to_implication_2}
			$A,B,C,D$を文とするとき，
			\begin{align}
				C \rarrow A,\ B \rarrow D \vdash (\, A \rarrow B\, ) 
				\rarrow (\, C \rarrow D\, ).
			\end{align}
		\end{logicalthm}
	\end{screen}
	
	\begin{sketch}
		三段論法より
		\begin{align}
			C,\ C \rarrow A \vdash A
		\end{align}
		が成り立つので，再び三段論法より
		\begin{align}
			C,\ A \rarrow B,\ C \rarrow A \vdash B
		\end{align}
		が成り立ち，再び三段論法より
		\begin{align}
			C,\ A \rarrow B,\ C \rarrow A,\ B \rarrow D \vdash D
		\end{align}
		が従う．そして演繹定理より
		\begin{align}
			C \rarrow A,\ B \rarrow D \vdash 
			(\, A \rarrow B\, ) \rarrow (\, C \rarrow D\, )
		\end{align}
		が得られる．
		\QED
	\end{sketch}
	
	%この原理の証明は相等性公理に負うところが多いが，
	%本稿では$\varepsilon$項という厄介なものを抱え込んでいるため
	%$\EQAX$だけでは不十分であり，次に追加する公理が必要になる．
	
	%\begin{screen}
	%	\begin{axm}[$\varepsilon$項に対する相等性公理]
	%		$a,b$を類とし，$\varphi$を$\lang{\varepsilon}$の式とし，$\varphi$には変項$x,y$が
	%		自由に現れ，また$\varphi$に自由に現れる変項はこれらのみであるとする．このとき
	%		\begin{align}
	%			\EQAXEP \defarrow
	%			a = b \rarrow \varepsilon x \varphi(x,a) 
	%			= \varepsilon x \varphi(x,b).
	%		\end{align}
	%	\end{axm}
	%\end{screen}
	
	\begin{screen}
		\begin{thm}[代入原理]\label{thm:the_principle_of_substitution}
			$a,b$を類とし，$\varphi$を$\mathcal{L}$の式とし，$x$を変項とし，
			$\varphi$には$x$のみ自由に現れるとする．このとき
			\begin{align}
				\EXTAX,\ \EQAX,\ \COMAX,\ \ELEAX \vdash a = b \rarrow 
				(\, \varphi(a) \lrarrow \varphi(b)\, )
			\end{align}
			が成り立つ．ただし$\varphi$が$\lang{\varepsilon}$の式であるときは
			\begin{align}
				\EXTAX,\EQAX \vdash a = b \rarrow 
				(\, \varphi(a) \lrarrow \varphi(b)\, ).
			\end{align}
		\end{thm}
	\end{screen}
	
	$\varphi$が$\lang{\varepsilon}$の式であるとして証明すれば十分である．
	実際$\varphi$を$x$のみが自由に現れる$\mathcal{L}$の式とし，
	$\varphi$を$\lang{\varepsilon}$の式に書き直したものを$\widehat{\varphi}$と書くと，
	$\lang{\varepsilon}$の式に対して代入原理が成り立つのであれば
	\begin{align}
		a = b,\ \EXTAX,\EQAX \vdash \widehat{\varphi}(a) \lrarrow \widehat{\varphi}(b)
	\end{align}
	がとなる．ここでメタ定理\ref{metathm:substitution_to_rewritten_formula}より
	$\widehat{\varphi}(a)$は$\varphi(a)$の書き換えであって，
	$\widehat{\varphi}(b)$は$\varphi(b)$の書き換えであるから，
	書き換えの同値性(\ref{sec:equivalence_of_formula_rewriting}節)より
	\begin{align}
		\EXTAX,\ \EQAX,\ \COMAX,\ \ELEAX &\vdash \varphi(a) \rarrow \widehat{\varphi}(a), \\
		\EXTAX,\ \EQAX,\ \COMAX,\ \ELEAX &\vdash \widehat{\varphi}(b) \rarrow \varphi(b)
	\end{align}
	が成り立つ．従って
	\begin{align}
		a = b,\ \EXTAX,\ \EQAX,\ \COMAX,\ \ELEAX \vdash \varphi(a) \lrarrow \varphi(b)
	\end{align}
	が出る．
	
	代入原理を示すには構造的帰納法の原理が必要になるので，証明はメタなものとなる．
	
	\begin{sketch}\mbox{}
		\begin{description}
			\item[step1]
				始めの$3$ステップでは$\varphi$が原子式であるとして考察する．
				$c$を類とすると，相等性公理から直接
				\begin{align}
					a = b,\ \EQAX \vdash a \in c \rarrow b \in c
				\end{align}
				となる．また
				\begin{align}
					a = b,\ \EQAX \vdash b = a
				\end{align}
				より
				\begin{align}
					a = b,\ \EQAX \vdash b \in c \rarrow a \in c
				\end{align}
				も成り立つ．従って
				\begin{align}
					a = b,\ \EQAX \vdash a \in c \lrarrow b \in c
				\end{align}
				が得られる．同様に
				\begin{align}
					a = b,\ \EQAX \vdash c \in a \lrarrow c \in b
				\end{align}
				も得られるので，$\varphi$が
				\begin{align}
					x \in c
				\end{align}
				や
				\begin{align}
					c \in x
				\end{align}
				なる式であるときは
				\begin{align}
					\EQAX \vdash a = b \rarrow (\, \varphi(a) \lrarrow \varphi(b)\, )
				\end{align}
				が成り立つ．
			
			\item[step2]
				$c$を類とすると，等号の推移律(定理\ref{thm:transitive_law_of_equality})より
				\begin{align}
					a = b,\ \EXTAX,\EQAX \vdash a = c \rarrow b = c
				\end{align}
				となる．また
				\begin{align}
					a = b,\ \EQAX \vdash b = a
				\end{align}
				と等号の推移律(定理\ref{thm:transitive_law_of_equality})より
				\begin{align}
					a = b,\ \EXTAX,\EQAX \vdash b = c \rarrow a = c
				\end{align}
				も成り立つ．従って
				\begin{align}
					a = b,\ \EXTAX,\EQAX \vdash a = c \lrarrow b = c
				\end{align}
				が得られる．つまり$\varphi$が
				\begin{align}
					x = c
				\end{align}
				なる式であるときは
				\begin{align}
					\EQAX \vdash a = b \rarrow (\, \varphi(a) \lrarrow \varphi(b)\, )
				\end{align}
				が成り立つ．
				
			\item[step3]
				$c$を類とすると，等号の推移律(定理\ref{thm:transitive_law_of_equality})より
				\begin{align}
					a = b,\ \EXTAX,\EQAX \vdash a = c \rarrow b = c
				\end{align}
				となるが，ここで
				\begin{align}
					c = a,\ \EQAX \vdash a = c
				\end{align}
				なので
				\begin{align}
					c = a,\ a = b,\ \EXTAX,\EQAX \vdash b = c
				\end{align}
				が成り立ち，また
				\begin{align}
					\EQAX \vdash b = c \rarrow c = b
				\end{align}
				より
				\begin{align}
					c = a,\ a = b,\ \EXTAX,\EQAX \vdash c = b
				\end{align}
				が従い，演繹定理より
				\begin{align}
					a = b,\ \EXTAX,\EQAX \vdash c = a \rarrow c = b
					\label{fom:the_principle_of_substitution_1}
				\end{align}
				が得られる．
				\begin{align}
					a = b,\ \EXTAX,\EQAX \vdash b = a
				\end{align}
				と(\refeq{fom:the_principle_of_substitution_1})より
				\begin{align}
					a = b,\ \EXTAX,\EQAX \vdash c = b \rarrow c = a
				\end{align}
				も得られるので
				\begin{align}
					a = b,\ \EXTAX,\EQAX \vdash c = a \lrarrow c = b
				\end{align}
				が成り立つ．従って$\varphi$が
				\begin{align}
					c = x
				\end{align}
				なる式であるときも
				\begin{align}
					\EXTAX,\EQAX \vdash a = b \rarrow (\, \varphi(a) \lrarrow \varphi(b)\, )
				\end{align}
				が成り立つ．
			
			\item[step4]
				$\varphi$を$x$のみが自由に現れる$\lang{\varepsilon}$の式として
				\begin{itembox}[l]{IH (帰納法の仮定)}
					$\varphi$の任意の真部分式$\psi$に対して，
					$\psi$に$x$のみが自由に現れているならば
					\begin{align}
						\EXTAX,\EQAX \vdash a = b \rarrow (\, \psi(a) \lrarrow \psi(b)\, )
					\end{align}
					が成り立つ．$\psi$に$x$以外の変項$y$もまた自由に現れているならば，
					任意の主要$\varepsilon$項$\tau$に対して
					\begin{align}
						\EXTAX,\EQAX \vdash a = b \rarrow (\, \psi(x/a,y/\tau) \lrarrow \psi(x/b,y/\tau)\, )
					\end{align}
					が成り立つ．
				\end{itembox}
				と仮定する．このとき
				\begin{description}
					\item[case1] $\varphi$が
						\begin{align}
							\negation \psi
						\end{align}
						なる式であるとき，(IH)より
						\begin{align}
							a = b,\ \EXTAX,\EQAX \vdash \psi(a) \lrarrow \psi(b)
						\end{align}
						が成り立つので，対偶を取れば
						\begin{align}
							a = b,\ \EXTAX,\EQAX \vdash\ 
							\negation \psi(a) \lrarrow\ \negation \psi(b)
						\end{align}
						が成り立つ．
						
					\item[case2]
						$\varphi$が
						\begin{align}
							\psi \vee \chi
						\end{align}
						なる式であるとき，
						\begin{align}
							\psi_{a} \defarrow
							\begin{cases}
								\psi(a) & \mbox{if $\psi$に$x$が自由に現れる} \\
								\psi & \mbox{if $\psi$に$x$が自由に現れない}
							\end{cases}
						\end{align}
						と定め，同様に$\psi_{b},\chi_{a},\chi_{b}$も定めれば，(IH)より
						\begin{align}
							a = b,\ \EXTAX,\EQAX &\vdash \psi_{a} \lrarrow \psi_{b}, \\
							a = b,\ \EXTAX,\EQAX &\vdash \chi_{a} \lrarrow \chi_{b}
						\end{align}
						が満たされる．従って論理的定理\ref{logicalthm:heredity_of_implication_to_disjunction_2}より
						\begin{align}
							a = b,\ \EXTAX,\EQAX \vdash\ 
							\negation \psi_{a} \vee \chi_{a} \lrarrow\ \negation \psi_{b} \vee \chi_{b}
						\end{align}
						が成り立つ．$\varphi$が
						\begin{align}
							\psi \wedge \chi
						\end{align}
						や
						\begin{align}
							\psi \rarrow \chi
						\end{align}
						なる式であるときも同様である．
					
					\item[case3]
						$\varphi$が
						\begin{align}
							\exists y \psi
						\end{align}
						なる式であるとき，つまり$\psi$には$x$と$y$が自由に現れるが，
						\begin{align}
							\tau \defeq \varepsilon y \psi(x/a)
						\end{align}
						と主要$\varepsilon$項を定めると，存在記号の論理的公理より
						\begin{align}
							\exists y \psi(x/a) \vdash \psi(x/a,y/\tau)
						\end{align}
						が成り立つ($\varphi(a)$と$\exists y \psi(x/a)$は一致する)．(IH)より
						\begin{align}
							a = b,\ \EXTAX,\EQAX \vdash 
							\psi(x/a,y/\tau) \rarrow \psi(x/b,y/\tau)
						\end{align}
						が成り立つので三段論法より
						\begin{align}
							\exists y \psi(x/a),\ a = b,\ \EXTAX,\EQAX \vdash 
							\psi(x/b,y/\tau)
						\end{align}
						が従い，存在記号の論理的公理より
						\begin{align}
							\exists y \psi(x/a),\ a = b,\ \EXTAX,\EQAX \vdash 
							\exists y \psi(x/b)
						\end{align}
						となり，演繹定理より
						\begin{align}
							a = b,\ \EXTAX,\EQAX \vdash 
							\exists y \psi(x/a) \rarrow \exists y \psi(x/b)
						\end{align}
						が出る．今度は
						\begin{align}
							\tau \defeq \varepsilon y \psi(x/b)
						\end{align}
						とおけば上と同様に
						\begin{align}
							a = b,\ \EXTAX,\EQAX \vdash 
							\exists y \psi(x/b) \rarrow \exists y \psi(x/a)
						\end{align}
						が成り立ち，
						\begin{align}
							a = b,\ \EXTAX,\EQAX \vdash 
							\exists y \psi(x/a) \lrarrow \exists y \psi(x/b)
						\end{align}
						が得られる．
						
					\item[case4]
						$\varphi$が
						\begin{align}
							\forall y \psi
						\end{align}
						なる式の場合は，まず$\tau$を
						\begin{align}
							\varepsilon y \negation \psi(x/b)
						\end{align}
						なる主要$\varepsilon$項とする．このとき全称記号の論理的公理より
						\begin{align}
							\forall y \psi(x/a) \vdash \psi(x/a,y/\tau)
						\end{align}
						が成り立ち($\varphi(a)$と$\forall y \psi(x/a)$は一致する)，(IH)より
						\begin{align}
							a = b,\ \EXTAX,\EQAX \vdash 
							\psi(x/a,y/\tau) \rarrow \psi(x/b,y/\tau)
						\end{align}
						が成り立つので三段論法より
						\begin{align}
							\forall y \psi(x/a),\ a = b,\ \EXTAX,\EQAX \vdash 
							\psi(x/b,y/\tau)
						\end{align}
						が従い，全称の導出\ref{logicalthm:derivation_of_universal_by_epsilon}より
						\begin{align}
							\forall y \psi(x/a),\ a = b,\ \EXTAX,\EQAX \vdash 
							\forall y \psi(x/b)
						\end{align}
						となり
						\begin{align}
							a = b,\ \EXTAX,\EQAX \vdash 
							\forall y \psi(x/a) \rarrow \forall y \psi(x/b)
						\end{align}
						が出る．今度は
						\begin{align}
							\tau \defeq \varepsilon \negation y \psi(x/a)
						\end{align}
						とおけば上と同様に
						\begin{align}
							a = b,\ \EXTAX,\EQAX \vdash 
							\forall y \psi(x/b) \rarrow \forall y \psi(x/a)
						\end{align}
						が成り立ち，
						\begin{align}
							a = b,\ \EXTAX,\EQAX \vdash 
							\forall y \psi(x/a) \lrarrow \forall y \psi(x/b)
						\end{align}
						が得られる．
						\QED
				\end{description}
				
			\begin{comment}
			%%%%%%%%%%%%%%%%%%%%%コメント%%%%%%%%%%%%%%%%%%%%%%
			\item[step2]
				$\varphi$が
				\begin{align}
					x \in \varepsilon y\, R(x,y)
				\end{align}
				なる式であるとき，
				\begin{align}
					a = b,\ \EQAXEP \vdash \varepsilon y\, R(a,y) = \varepsilon y\, R(b,y)
				\end{align}
				となる．
				\begin{align}
					a = b,\ \EXTAX,\EQAX 
					\vdash (\, \varepsilon y\, R(a,y) = \varepsilon y\, R(b,y)\, )
					\rarrow (\, a \in \varepsilon y\, R(a,y) \lrarrow a \in \varepsilon y\, R(b,y)\, )
				\end{align}
				なので
				\begin{align}
					a = b,\ \EXTAX,\EQAX,\EQAXEP \vdash 
					a \in \varepsilon y\, R(a,y) \lrarrow a \in \varepsilon y\, R(b,y)
				\end{align}
				となる．
				\begin{align}
					a=b,\ \EXTAX,\EQAX \vdash 
					a \in \varepsilon y\, R(b,y) \lrarrow b \in \varepsilon y\, R(b,y)
				\end{align}
				も成り立つので
				\begin{align}
					a=b,\ \EXTAX,\EQAX,\EQAXEP \vdash 
					a \in \varepsilon y\, R(a,y) \lrarrow b \in \varepsilon y\, R(b,y)
				\end{align}
				が得られる．
				
			\item[step3]
				$\varphi$が
				\begin{align}
					\varepsilon y R(x,y) \in \varepsilon z T(x,z)
				\end{align}
				なる形のとき，
				\begin{align}
					a = b,\ \EQAXEP \vdash 
					\varepsilon y R(a,y) = \varepsilon y R(b,y)
				\end{align}
				と
				\begin{align}
					a = b,\ \EQAX, \EQAXEP \vdash 
					(\, \varepsilon y R(a,y) = \varepsilon y R(b,y)\, )
					\rarrow (\, \varepsilon y R(a,y) \in \varepsilon z T(a,z)
					\lrarrow \varepsilon y R(b,y) \in \varepsilon z T(a,z)\, )
				\end{align}
				より
				\begin{align}
					a = b,\ \EQAX, \EQAXEP \vdash 
					\varepsilon y R(a,y) \in \varepsilon z T(a,z)
					\lrarrow \varepsilon y R(b,y) \in \varepsilon z T(a,z)
				\end{align}
				が成り立つ．他方で
				\begin{align}
					a = b,\ \EQAXEP \vdash 
					\varepsilon z T(a,z) = \varepsilon z T(b,z)
				\end{align}
				と
				\begin{align}
					a = b,\ \EQAX, \EQAXEP \vdash 
					(\, \varepsilon z T(a,z) = \varepsilon z T(b,z)\, )
					\rarrow (\, \varepsilon y R(b,y) \in \varepsilon z T(a,z)
					\lrarrow \varepsilon y R(b,y) \in \varepsilon z T(b,z)\, )
				\end{align}
				より
				\begin{align}
					a = b,\ \EQAX, \EQAXEP \vdash 
					\varepsilon y R(b,y) \in \varepsilon z T(a,z)
					\lrarrow \varepsilon y R(b,y) \in \varepsilon z T(b,z)
				\end{align}
				が成り立つ．同値関係の推移律
				(\ref{logicalthm:transitive_law_of_equivalence_symbol})より
				\begin{align}
					a = b,\ \EQAX, \EQAXEP \vdash 
					\varepsilon y R(a,y) \in \varepsilon z T(a,z)
					\lrarrow \varepsilon y R(b,y) \in \varepsilon z T(b,z)
				\end{align}
				が成立する．
			%%%%%%%%%%%%%%%%%%%%%コメント%%%%%%%%%%%%%%%%%%%%%%
			\end{comment}
			
		\end{description}
	\end{sketch}